(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();class O{constructor(){this.bits=0}getBits(){return this.bits}addBits(e){this.bits+=e}resetBits(){this.bits=0}}class p{constructor(e,t){this.message=e,this.isFinished=t}getMessage(){return this.message}getIsFinished(){return this.isFinished}}class E{constructor(e,t){this.bits=0,this.symbol=e,this.wins=0,this.availableMoves=t}getBits(){return this.bits}getSymbol(){return this.symbol}getWins(){return this.wins}getAvailableMoves(){return this.availableMoves}addBits(e){this.bits+=e}resetBits(){this.bits=0}incrementWins(){this.wins++}resetWins(){this.wins=0}decrementAvailableMoves(){this.availableMoves--}setAvailableMoves(e){this.availableMoves=e}}const A=[7,56,448,73,146,292,273,84],P=[1,2,4,8,16,32,64,128,256],M=511,d="",b="0",f="wins!",B="Cats game!",g={X:"X",O:"O"},u={X:"player-x-color",O:"player-o-color"},c={FIRST:5,SECOND:4},m={CLICK:"click"},L={DIV:"div"},o={SQUARE:"square",ALERT:"alert",BACKDROP:"backdrop",ALERT_MESSAGE:"alert-message",SCORE_MESSAGE:"score-message",DOT:"active-player-dot",MODE:"mode",GAME:"game",AI_INDICATOR:"ai-indicator"},v={RESET:"reset",NEW_GAME:"new-game",MODE:"mode-btn"},l={DISPLAY_BLOCK:"block",DISPLAY_NONE:"none",DISPLAY_FLEX:"flex"},C={BITS:"data-bits"},S={X:"x-turn",O:"o-turn"};var I=(a=>(a.PvP="PvP",a.PvE="PvE",a))(I||{});class w{constructor(e,t){this.playerX=new E(g.X,c.FIRST),this.playerO=new E(g.O,c.SECOND),this.startingPlayer=this.playerX,this.currentPlayer=this.startingPlayer,this.board=t,this.gameMode=I.PvP,this.ai=e}makeMove(e){return this.isCellOccupied(e)?this.currentPlayer.getSymbol():(this.board.addBits(e),this.currentPlayer.addBits(e),this.currentPlayer.decrementAvailableMoves(),this.currentPlayer.getSymbol())}makeAIMove(){return this.ai.getBestMove(this.playerX.getBits(),this.playerO.getBits())}hasGameFinished(){if(this.isGameWon()){this.currentPlayer.incrementWins();const e=`${this.currentPlayer.getSymbol()} ${f}`;return new p(e,!0)}return this.isGameDrawn()?new p(B,!0):new p(d,!1)}setGameMode(e){this.gameMode=e}isAgainstAI(){return this.gameMode===I.PvE}getCurrentPlayerSymbol(){return this.currentPlayer.getSymbol()}switchCurrentPlayer(){this.currentPlayer=this.currentPlayer===this.playerX?this.playerO:this.playerX}isCellOccupied(e){return(this.board.getBits()&e)!==0}getCurrentResult(){return`${this.playerX.getWins()}:${this.playerO.getWins()}`}startNewGame(){this.board.resetBits(),this.playerX.resetBits(),this.playerO.resetBits(),this.switchStartingPlayer(),this.currentPlayer=this.startingPlayer}resetGame(){this.board.resetBits(),this.playerX.resetBits(),this.playerO.resetBits(),this.playerX.resetWins(),this.playerO.resetWins(),this.playerX.setAvailableMoves(c.FIRST),this.playerO.setAvailableMoves(c.SECOND),this.startingPlayer=this.playerX,this.currentPlayer=this.startingPlayer}switchStartingPlayer(){this.startingPlayer=this.startingPlayer===this.playerX?this.playerO:this.playerX,this.startingPlayer===this.playerO?this.playerO.setAvailableMoves(c.FIRST):this.playerO.setAvailableMoves(c.SECOND),this.startingPlayer===this.playerX?this.playerX.setAvailableMoves(c.FIRST):this.playerX.setAvailableMoves(c.SECOND)}isGameWon(){const e=this.currentPlayer.getBits();return this.board.areWinningBits(e)}isGameDrawn(){const e=this.playerX.getBits(),t=this.playerX.getAvailableMoves(),s=this.playerO.getBits(),i=this.playerO.getAvailableMoves();return this.board.areDrawnBits(e,t,s,i)}}class T{getBestMove(e,t){let s=-1/0,i=0;const r=this.getAvailableMoves(e,t);for(const n of r){const h=t+n,y=this.minimax(e,h,!1);y>s&&(s=y,i=n)}return i}minimax(e,t,s){if(this.isWinner(t))return 1;if(this.isWinner(e))return-1;if(this.isDraw(e,t))return 0;const i=this.getAvailableMoves(e,t);let r=s?-1/0:1/0;for(const n of i)if(s){const h=this.minimax(e,t+n,!1);r=Math.max(h,r)}else{const h=this.minimax(e+n,t,!0);r=Math.min(h,r)}return r}getAvailableMoves(e,t){const s=e+t;return P.filter(i=>(s&i)===0)}isWinner(e){return A.some(t=>(e&t)===t)}isDraw(e,t){return e+t===M}}class R{constructor(){this.board=new O}addBits(e){this.board.addBits(e)}getBits(){return this.board.getBits()}resetBits(){this.board.resetBits()}areWinningBits(e){for(let t of A)if((e&t)===t)return!0;return!1}areDrawnBits(e,t,s,i){if(this.board.getBits()==M)return!0;const r=this.canStillWin(e,t),n=this.canStillWin(s,i);return!r&&!n}canStillWin(e,t){const s=~this.board.getBits()&M;return A.some(i=>{const r=i&~e,n=this.countRequiredMoves(r),h=(r&s)===r,y=n<=t;return h&&y})}countRequiredMoves(e){let t=0;for(;e;)t+=e&1,e>>=1;return t}}class D{constructor(e,t){this.game=e,this.ui=t,this.inputLocked=!1}onModeSelect(e){this.game.resetGame(),this.game.setGameMode(e),this.ui.showGame(),this.ui.displayScore(this.game.getCurrentResult()),this.ui.updateActivePlayer(this.game.getCurrentPlayerSymbol())}onCellClick(e){if(this.game.isCellOccupied(e))return;const t=this.game.makeMove(e);this.ui.updateCell(e,t);const s=this.game.hasGameFinished();if(s.getIsFinished()){this.ui.showResult(s.getMessage()),this.game.startNewGame(),this.ui.resetBoard(),this.ui.displayScore(this.game.getCurrentResult()),this.hasToMakeAIMove()&&this.makeAIMove(3500),this.ui.updateActivePlayer(this.game.getCurrentPlayerSymbol());return}this.game.switchCurrentPlayer(),this.ui.updateActivePlayer(this.game.getCurrentPlayerSymbol()),this.hasToMakeAIMove()&&this.makeAIMove(500)}onResetClick(){this.game.resetGame(),this.ui.resetBoard(),this.ui.displayScore(this.game.getCurrentResult()),this.ui.updateActivePlayer(this.game.getCurrentPlayerSymbol())}onNewGameClick(){this.onResetClick(),this.ui.showModeSelector()}isInputLocked(){return this.inputLocked}lockInput(){this.inputLocked=!0}unlockInput(){this.inputLocked=!1}hasToMakeAIMove(){return this.game.isAgainstAI()&&this.game.getCurrentPlayerSymbol()===g.O}makeAIMove(e){this.lockInput(),this.ui.showAIIndicator(),setTimeout(()=>{const t=this.game.makeAIMove();this.unlockInput(),this.ui.hideAIIndicator(),this.onCellClick(t)},e)}}class N{constructor(e){this.orchestrator=e}init(){this.initModeButtons(),this.initGameBoard(),this.initResetButton(),this.initNewGameButton()}initModeButtons(){document.querySelectorAll(`.${v.MODE}`).forEach(e=>{e.addEventListener(m.CLICK,t=>{const s=t.target.dataset.mode;this.orchestrator.onModeSelect(s)})})}initGameBoard(){document.querySelectorAll(`.${o.SQUARE}`).forEach(e=>{e.addEventListener(m.CLICK,()=>{if(this.orchestrator.isInputLocked())return;const t=parseInt(e.getAttribute(C.BITS)||b);this.orchestrator.onCellClick(t)})})}initResetButton(){var e;(e=document.querySelector(`.${v.RESET}`))==null||e.addEventListener(m.CLICK,()=>{this.orchestrator.onResetClick()})}initNewGameButton(){var e;(e=document.querySelector(`.${v.NEW_GAME}`))==null||e.addEventListener(m.CLICK,()=>{this.orchestrator.onNewGameClick()})}}class G{updateCell(e,t){const s=document.querySelector(`[${C.BITS}="${e}"]`);s&&!s.innerHTML&&(s.textContent=t,s.classList.remove(u.X,u.O),s.classList.add(u[t]))}resetBoard(){document.querySelectorAll(`.${o.SQUARE}`).forEach(e=>{e.textContent=d,e.classList.remove(u.X,u.O)})}updateActivePlayer(e){const t=document.querySelector(`.${o.DOT}`);t&&(t.classList.remove(S.X,S.O),t.classList.add(e===g.X?S.X:S.O))}displayScore(e){const t=document.querySelector(`.${o.SCORE_MESSAGE}`);t&&(t.textContent=e)}showResult(e){const t=document.querySelector(`.${o.ALERT}`),s=document.querySelector(`.${o.BACKDROP}`);if(t&&s){const i=document.createElement(L.DIV);i.className=o.ALERT_MESSAGE,i.textContent=e,t.innerHTML=d,t.appendChild(i),t.style.display=l.DISPLAY_BLOCK,s.style.display=l.DISPLAY_BLOCK,setTimeout(()=>{t.style.display=l.DISPLAY_NONE,s.style.display=l.DISPLAY_NONE,t.innerHTML=d,s.innerHTML=d},3e3)}}showGame(){document.querySelector(`.${o.GAME}`).style.display=l.DISPLAY_BLOCK,document.querySelector(`.${o.MODE}`).style.display=l.DISPLAY_NONE}showModeSelector(){document.querySelector(`.${o.GAME}`).style.display=l.DISPLAY_NONE,document.querySelector(`.${o.MODE}`).style.display=l.DISPLAY_BLOCK}showAIIndicator(){const e=document.querySelector(`.${o.AI_INDICATOR}`);e&&(e.style.display=l.DISPLAY_FLEX)}hideAIIndicator(){const e=document.querySelector(`.${o.AI_INDICATOR}`);e&&(e.style.display=l.DISPLAY_NONE)}}const X=new T,_=new G,k=new R,W=new w(X,k),q=new D(W,_),$=new N(q);$.init();
